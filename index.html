<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="本人目前从事机器学习相关研究和工作，对机器学习和深度学习仍在入门阶段。开此博客，希望记录学习路上的一些体会，还有对生活的一些思考。" />
  

  
  <meta name="keywords" content="AI ML DL life" />
  
  
  
  
  
  
  <title>山风之行</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本人目前从事机器学习相关研究和工作，对机器学习和深度学习仍在入门阶段。开此博客，希望记录学习路上的一些体会，还有对生活的一些思考。">
<meta name="keywords" content="AI ML DL life">
<meta property="og:type" content="website">
<meta property="og:title" content="山风之行">
<meta property="og:url" content="http://xurui.club/index.html">
<meta property="og:site_name" content="山风之行">
<meta property="og:description" content="本人目前从事机器学习相关研究和工作，对机器学习和深度学习仍在入门阶段。开此博客，希望记录学习路上的一些体会，还有对生活的一些思考。">
<meta property="og:locale" content="zh-Ch">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="山风之行">
<meta name="twitter:description" content="本人目前从事机器学习相关研究和工作，对机器学习和深度学习仍在入门阶段。开此博客，希望记录学习路上的一些体会，还有对生活的一些思考。">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="山风之行" rel="home">山风之行</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">—— 修养 风范 血性 胆识</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">主页</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">文章</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/about">关于</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-hbase" class="post-hbase post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/08/31/hbase/">hbase</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2019/08/31/hbase/" data-id="ck00i1n0z0038lcdaocfqlqs8" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="1-hbase简介"><a href="#1-hbase简介" class="headerlink" title="1 hbase简介"></a>1 hbase简介</h1><h2 id="1-1-hbase是什么"><a href="#1-1-hbase是什么" class="headerlink" title="1.1 hbase是什么"></a>1.1 hbase是什么</h2><p>HBASE是一个高可靠性、高性能、<strong>面向列</strong>、可伸缩的分布式存储系统，利用HBASE技术可在廉价PC Server上搭建起大规模结构化存储集群。<br>HBASE的目标是存储并处理大型的数据，更具体来说是仅需使用普通的硬件配置，就能够处理由成千上万的行和列所组成的大型数据。<br>HBASE是Google Bigtable的开源实现，但是也有很多不同之处。比如：Google Bigtable利用GFS作为其文件存储系统，HBASE利用Hadoop HDFS作为其文件存储系统；Google运行MAPREDUCE来处理Bigtable中的海量数据，HBASE同样利用Hadoop MapReduce来处理HBASE中的海量数据；Google Bigtable利用Chubby作为协同服务，HBASE利用Zookeeper作为对应。<br>HBase集群有两种角色：<strong>Hmaster</strong> 和 <strong>HregionServer</strong><br>Hdfs适合存整块数据，如果大量数据一条一条存，namenode难以承受，所以有了Hbase。一条数据来时，先缓存到HregionServer内存，128M满了后写到hdfs上。</p>
<p>hmaster的作用：</p>
<ul>
<li>管理HregionServer，如果hregionserver挂了，hmaster管理数据迁移。</li>
<li>连接zk的API，做增删改查 表的节点，创建zk节点，管理映射信息</li>
<li>管理HregionServer中的表分配，也就管理元数据，保存表的位置，表的具体数据，在hregionServer上。表创建后，就跟hmaster没关系了，可以直接通过zk增删改查，hmaster只是在zk注册了节点。</li>
</ul>
<p>hregionserver作用</p>
<ul>
<li>表的增删改查数据。</li>
<li>和hdfs交互，存取数据。</li>
</ul>
<h2 id="1-2-hbase优势"><a href="#1-2-hbase优势" class="headerlink" title="1.2 hbase优势"></a>1.2 hbase优势</h2><p>hbase是一种分布式数据库，相比于传统数据库的优势在于：</p>
<ul>
<li>线性扩展，随着数据量增多可以通过节点扩展进行支撑</li>
<li>数据存储在hdfs上，备份机制健全</li>
<li>通过zookeeper协调查找数据，访问速度块。</li>
</ul>
<p>但是hbase主要用来存海量数据，列式数据库无法做多表关联。</p>
<h1 id="2-hbase安装"><a href="#2-hbase安装" class="headerlink" title="2 hbase安装"></a>2 hbase安装</h1><p>主要包括以下步骤</p>
<ul>
<li>下载hbase安装包</li>
<li>解压，重命名</li>
<li>修改环境变量，vi /ect/profile 然后source一下激活修改</li>
<li>修改配置文件</li>
<li>分发到其他节点机</li>
<li>启动，先启动hadoop和zookeeper集群,然后start-hbase.sh</li>
<li>进行命令行hbase shell<br>启动后Jps查看：<br><img src="hbase-jps.png" alt=""></li>
</ul>
<h1 id="3-hbase数据模型"><a href="#3-hbase数据模型" class="headerlink" title="3 hbase数据模型"></a>3 hbase数据模型</h1><h2 id="3-1-hbase数据模型"><a href="#3-1-hbase数据模型" class="headerlink" title="3.1 hbase数据模型"></a>3.1 hbase数据模型</h2><p><img src="hbase数据模型.png" alt=""></p>
<h2 id="3-2-rowkey"><a href="#3-2-rowkey" class="headerlink" title="3.2 rowkey"></a>3.2 rowkey</h2><p>row key是用来检索记录的主键。访问HBASE table中的行，只有三种方式：</p>
<ul>
<li>通过单个row key访问</li>
<li>通过row key的range（正则）</li>
<li>全表扫描</li>
</ul>
<p>在HBASE内部，row key保存为字节数组。存储时，数据按照Row key的<strong>字典序</strong>(byte order)排序存储。设计key时，要充分排序存储这个特性，将经常一起读取的行存储放到一起。(位置相关性)</p>
<h2 id="3-3-Columns-Family"><a href="#3-3-Columns-Family" class="headerlink" title="3.3 Columns Family"></a>3.3 Columns Family</h2><p>列簇 ：HBASE表中的每个列，都归属于某个<strong>列族</strong>。列族是表的schema的一部分(而列不是,列不是表结构，而是作为数据)，必须在使用表之前定义。列名都以列族作为前缀。例如 courses:history，courses:math都属于courses 这个列族。</p>
<h2 id="3-4-cell"><a href="#3-4-cell" class="headerlink" title="3.4 cell"></a>3.4 cell</h2><p>由{row key, columnFamily, version} 唯一确定的单元格（row key确定是哪个id的数据，再由列簇确定列，再由时间版本确定唯一单元格）。cell中 的数据是<strong>没有类型</strong>的，全部是<strong>字节码</strong>形式存贮。</p>
<h2 id="3-5-Time-Stamp"><a href="#3-5-Time-Stamp" class="headerlink" title="3.5 Time Stamp"></a>3.5 Time Stamp</h2><p>HBASE 中通过rowkey和columns确定的为一个存贮单元称为cell。每个 cell都保存 着同一份数据的多个版本。版本通过时间戳来索引。时间戳的类型是 64位整型。时间戳可以由HBASE(在数据写入时自动 )赋值，此时时间戳是精确到毫秒 的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版 本冲突，就必须自己生成具有唯一性的时间戳。每个 cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。<br>为了避免数据存在过多版本造成的的管理 (包括存贮和索引)负担，HBASE提供 了两种数据版本回收方式。一是保存数据的最后n个版本，二是保存最近一段 时间内的版本（比如最近七天）。用户可以针对每个列族进行设置。</p>
<h2 id="3-5-更新"><a href="#3-5-更新" class="headerlink" title="3.5 更新"></a>3.5 更新</h2><p>hbase没有update的概念，若想修改数据，就用下一条数据，覆盖上一条，rowkey相同。</p>
<h1 id="4-hbase命令"><a href="#4-hbase命令" class="headerlink" title="4 hbase命令"></a>4 hbase命令</h1><table>
<thead>
<tr>
<th style="text-align:center">功能</th>
<th style="text-align:center">命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">进入</td>
<td style="text-align:center">hbase shell </td>
</tr>
<tr>
<td style="text-align:center">退出</td>
<td style="text-align:center">quit</td>
</tr>
<tr>
<td style="text-align:center">创建表</td>
<td style="text-align:center">create ‘表名’, ‘列族名1’,’列族名2’,’列族名N’</td>
</tr>
<tr>
<td style="text-align:center">查看所有表</td>
<td style="text-align:center">list</td>
</tr>
<tr>
<td style="text-align:center">描述表</td>
<td style="text-align:center">describe  ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">判断表存在</td>
<td style="text-align:center">exists  ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">判断是否禁用启用表</td>
<td style="text-align:center">is_enabled ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">添加记录</td>
<td style="text-align:center">put  ‘表名’, ‘rowKey’, ‘列族 : 列’  ,  ‘值’</td>
</tr>
<tr>
<td style="text-align:center">查看记录rowkey下的所有数据</td>
<td style="text-align:center">get  ‘表名’ , ‘rowKey’</td>
</tr>
<tr>
<td style="text-align:center">查看表中的记录总数</td>
<td style="text-align:center">count  ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">获取某个列族</td>
<td style="text-align:center">get ‘表名’,’rowkey’,’列族’</td>
</tr>
<tr>
<td style="text-align:center">获取某个列族的某个列</td>
<td style="text-align:center">get ‘表名’,’rowkey’,’列族：列’</td>
</tr>
<tr>
<td style="text-align:center">删除记录</td>
<td style="text-align:center">delete  ‘表名’ ,’行名’ , ‘列族：列’</td>
</tr>
<tr>
<td style="text-align:center">删除整行</td>
<td style="text-align:center">deleteall ‘表名’,’rowkey’</td>
</tr>
<tr>
<td style="text-align:center">删除一张表</td>
<td style="text-align:center">先要屏蔽该表，才能对该表进行删除 第一步 disable ‘表名’ ，第二步  drop ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">清空表</td>
<td style="text-align:center">truncate ‘表名’</td>
</tr>
<tr>
<td style="text-align:center">查看所有记录</td>
<td style="text-align:center">scan ‘表名’  </td>
</tr>
<tr>
<td style="text-align:center">查看某个表某个列中所有数据</td>
<td style="text-align:center">scan ‘表名’ , {COLUMNS=&gt;’列族名:列名’}</td>
</tr>
<tr>
<td style="text-align:center">更新记录</td>
<td style="text-align:center">就是重写一遍，进行覆盖，hbase没有修改，都是追加</td>
</tr>
</tbody>
</table>
<p><img src="hbase-shell.png" alt=""></p>
<h1 id="5-hbase依赖zookeeper"><a href="#5-hbase依赖zookeeper" class="headerlink" title="5 hbase依赖zookeeper"></a>5 hbase依赖zookeeper</h1><p><img src="zk.png" alt=""><br>通过zk知道rowkey那条记录该放哪个regionserver上，找数据通过zk，不通过hmaster。</p>
<ul>
<li>hbase regionserver向zookeeper注册，提供hbase regionserver状态信息（是否在线）。</li>
<li>hmaster启动时候会将hbase系统表-ROOT-加载到zookeeper cluster，通过zookeeper cluster可以获取当前系统表.META.的存储所对应的regionserver信息</li>
<li>保存Hmaster的地址和backup-master地址</li>
<li>保存表-ROOT-的地址，（hbase默认的根表，检索表）</li>
<li>HRegionServer列表</li>
</ul>
<h1 id="6-java-API"><a href="#6-java-API" class="headerlink" title="6 java API"></a>6 java API</h1><p>注意： 在eclipse中操作响应太慢，集群为虚拟机集群，改了本机的host文件后，响应正常。</p>
<h2 id="6-1基础api"><a href="#6-1基础api" class="headerlink" title="6.1基础api"></a>6.1基础api</h2><table>
<thead>
<tr>
<th style="text-align:center">功能</th>
<th style="text-align:center">API</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">配置</td>
<td style="text-align:center">HBaseConfiguration</td>
<td style="text-align:center">通过此类可以对HBase进行配置</td>
<td style="text-align:center">Configuration config = HBaseConfiguration.create();</td>
</tr>
<tr>
<td style="text-align:center">表管理类</td>
<td style="text-align:center">HBaseAdmin</td>
<td style="text-align:center">提供接口关系HBase 数据库中的表信息</td>
<td style="text-align:center">HBaseAdmin admin = new HBaseAdmin(config);</td>
</tr>
<tr>
<td style="text-align:center">表描述类</td>
<td style="text-align:center">HTableDescriptor</td>
<td style="text-align:center">类包含了表的名字以及表的列族信息</td>
<td style="text-align:center">HTableDescriptor htd =new HTableDescriptor(tablename);<br>htd.addFamily(new HColumnDescriptor(“myFamily”));</td>
</tr>
<tr>
<td style="text-align:center">列簇描述类</td>
<td style="text-align:center">HColumnDescriptor</td>
<td style="text-align:center">维护列族的信息 ｜ htd.addFamily(new HColumnDescriptor(“myFamily”));  </td>
</tr>
</tbody>
</table>
<h2 id="6-2-增删改查"><a href="#6-2-增删改查" class="headerlink" title="6.2 增删改查"></a>6.2 增删改查</h2><table>
<thead>
<tr>
<th style="text-align:center">功能</th>
<th style="text-align:center">API</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">创建表</td>
<td style="text-align:center">CreateTable</td>
<td style="text-align:center">HBaseAdmin admin = new HBaseAdmin(config);<br>HTableDescriptor desc = new HTableDescriptor(tableName);<br>HColumnDescriptor family1 = new HColumnDescriptor(“f1”);<br>HColumnDescriptor family2 = new HColumnDescriptor(“f2”);<br>desc.addFamily(family1);<br>desc.addFamily(family2);<br>admin.createTable(desc);</td>
</tr>
<tr>
<td style="text-align:center">删除表</td>
<td style="text-align:center">disableTable<br>deleteTable</td>
<td style="text-align:center">HBaseAdmin admin = new HBaseAdmin(config);<br>admin.disableTable(tableName);<br>admin.deleteTable(tableName);</td>
</tr>
<tr>
<td style="text-align:center">创建表类</td>
<td style="text-align:center">HTable</td>
<td style="text-align:center">// 普通获取表<br> HTable table = new HTable(config,Bytes.toBytes(tablename);<br>// 通过连接池获取表<br>Connection connection = ConnectionFactory.createConnection(config);<br>HTableInterface table = connection.getTable(TableName.valueOf(“user”));</td>
</tr>
<tr>
<td style="text-align:center">单条插入</td>
<td style="text-align:center">put</td>
<td style="text-align:center">Put put = new Put(row);<br>p.add(family,qualifier,value);</td>
</tr>
<tr>
<td style="text-align:center">批量插入</td>
<td style="text-align:center">-</td>
<td style="text-align:center">List<put> list = new ArrayList<put>();<br>Put put = new Put(Bytes.toBytes(rowKey));//获取put，用于插入<br>put.add(Bytes.toBytes(family), Bytes.toBytes(qualifier),Bytes.toBytes(value));//封装信息<br>list.add(put);<br>table.put(list);//添加记录</put></put></td>
</tr>
<tr>
<td style="text-align:center">删除数据</td>
<td style="text-align:center">Delete</td>
<td style="text-align:center">Delete del= new Delete(Bytes.toBytes(rowKey));<br>table.delete(del);</td>
</tr>
<tr>
<td style="text-align:center">单条查询</td>
<td style="text-align:center">Get</td>
<td style="text-align:center">HTable table = new HTable(config,Bytes.toBytes(tablename));<br>Get get = new Get(Bytes.toBytes(row));<br>Result result = table.get(get);</td>
</tr>
<tr>
<td style="text-align:center">批量查询</td>
<td style="text-align:center">ResultScanner</td>
<td style="text-align:center">ResultScanner scanner = table.getScanner(scan);<br>For(Result rowResult : scanner)<br>{ Bytes[] str = rowResult.getValue(family,column);}</td>
</tr>
</tbody>
</table>
<h2 id="6-3-过滤器"><a href="#6-3-过滤器" class="headerlink" title="6.3 过滤器"></a>6.3 过滤器</h2><p>FilterList 代表一个过滤器列表，可以添加多个过滤器进行查询，多个过滤器之间的关系有：<br>与关系（符合所有）：FilterList.Operator.MUST_PASS_ALL<br>或关系（符合任一）：FilterList.Operator.MUST_PASS_ONE<br>过滤器种类有：</p>
<ul>
<li>列植过滤器—SingleColumnValueFilter：过滤列植的相等、不等、范围等</li>
<li>列名前缀过滤器—ColumnPrefixFilter：过滤指定前缀的列名</li>
<li>多个列名前缀过滤器—MultipleColumnPrefixFilter：过滤多个指定前缀的列名</li>
<li>rowKey过滤器—RowFilter:通过正则，过滤rowKey值。</li>
</ul>
<h1 id="7-hbase-原理"><a href="#7-hbase-原理" class="headerlink" title="7 hbase 原理"></a>7 hbase 原理</h1><p><img src="结构图.png" alt=""></p>
<h2 id="7-1-写"><a href="#7-1-写" class="headerlink" title="7.1 写"></a>7.1 写</h2><ul>
<li>client向hregionserver发送写请求。</li>
<li>hregionserver将数据写到hlog（write ahead log）。为了数据的持久化和恢复。</li>
<li>hregionserver将数据写到内存（memstore）</li>
<li>反馈client写成功。</li>
</ul>
<h2 id="7-2-数据flush"><a href="#7-2-数据flush" class="headerlink" title="7.2 数据flush"></a>7.2 数据flush</h2><ul>
<li>当memstore数据达到阈值（默认是64M），将数据刷到硬盘，将内存中的数据删除，同时删除Hlog中的历史数据。</li>
<li>并将数据存储到hdfs中。</li>
<li>在hlog中做标记点。</li>
</ul>
<h2 id="7-3-数据合并"><a href="#7-3-数据合并" class="headerlink" title="7.3 数据合并"></a>7.3 数据合并</h2><ul>
<li>当数据块达到4块，hmaster将数据块加载到本地，进行合并</li>
<li>当合并的数据超过256M，进行拆分，将拆分后的region分配给不同的hregionserver管理</li>
<li>当hregionser宕机后，将hregionserver上的hlog拆分，然后分配给不同的hregionserver加载，修改.META.    </li>
<li>注意：hlog会同步到hdfs，以保证该机器坏了，hlog有备份，但是hlog不是实时同步的，若一周同步一次，则宕机这一周的数据无法恢复。</li>
</ul>
<h2 id="7-4-读"><a href="#7-4-读" class="headerlink" title="7.4 读"></a>7.4 读</h2><ul>
<li>通过zookeeper和-ROOT- .META.表定位hregionserver（与xookeeper来回交互）</li>
<li>数据从内存和硬盘合并后返回给client</li>
<li>数据块会缓存（常用数据会缓存到内存中）</li>
</ul>
<h2 id="7-5-hmaster职责"><a href="#7-5-hmaster职责" class="headerlink" title="7.5 hmaster职责"></a>7.5 hmaster职责</h2><ul>
<li>管理用户对Table的增、删、改、查操作； </li>
<li>记录region在哪台Hregion server上</li>
<li>在Region Split后，负责新Region的分配； </li>
<li>新机器加入时，管理HRegion Server的负载均衡，调整Region分布</li>
<li>在HRegion Server宕机后，负责失效HRegion Server 上的Regions迁移。</li>
</ul>
<h2 id="7-6-hregionserver职责"><a href="#7-6-hregionserver职责" class="headerlink" title="7.6 hregionserver职责"></a>7.6 hregionserver职责</h2><ul>
<li>HRegion Server主要负责响应用户I/O请求，向HDFS文件系统中读写数据，是HBASE中最核心的模块。</li>
<li>HRegion Server管理了很多table的分区，也就是region。</li>
</ul>
<h2 id="7-7-client职责"><a href="#7-7-client职责" class="headerlink" title="7.7 client职责"></a>7.7 client职责</h2><p>HBASE Client使用HBASE的RPC机制与HMaster和RegionServer进行通信</p>
<ul>
<li>管理类操作：Client与HMaster进行RPC；</li>
<li>数据读写类操作：Client与HRegionServer进行RPC。</li>
</ul>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/08/31/hbase/">
    <time datetime="2019-08-31T14:00:50.000Z" class="entry-date">
        2019-08-31
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-hive" class="post-hive post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/07/21/hive/">hive 之join的用法</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2019/07/21/hive/" data-id="ck00i1mye0002lcdam6ej9283" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>Join 在 hive 中可将两个表连接在一起。包括<code>join</code>,<code>inner join</code>,<code>left join</code>, <code>right join</code>, <code>full outer join</code>,<code>left semi join</code>等，下面进行一一讲解。</p>
<p>表student<br><img src="https://i.imgur.com/whkVvQG.png" alt="表student"></p>
<p>表sc<br><img src="https://i.imgur.com/9mMLrzl.png" alt="表sc"></p>
<p>##join(等同于inner join)<br>左右两表中id字段相同的做迪卡尔积，若只有一张表中出现了某id，则该值不会出现在结果中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student s join sc on s.sno = sc.sno;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/lz1UVax.png" alt=""></p>
<h2 id="left-join-right-join-类似"><a href="#left-join-right-join-类似" class="headerlink" title="left join(right join 类似)"></a>left join(right join 类似)</h2><p>左右两表中id字段相同的做迪卡尔积，若只有左表中出现了某id，则结果中会出现该条记录，但右部分用null补齐；若只有右表中出现了某id，则该值不会出现在结果中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student s left join sc on s.sno = sc.sno;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/HrXfZX2.png" alt=""></p>
<h2 id="full-outer-join"><a href="#full-outer-join" class="headerlink" title="full outer join"></a>full outer join</h2><p>左右两表中id字段相同的做迪卡尔积，若只有一张表中出现了某id，则结果中会出现该记录，左右缺失部分用null补齐。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student s full outer join sc on s.sno = sc.sno;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.imgur.com/j9wEeYH.png" alt=""></p>
<p>##left semi join<br>相当于inner join中取左边的一半<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student s left semi join sc on s.sno = sc.sno;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.imgur.com/SCfSLcJ.png" alt=""></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/07/21/hive/">
    <time datetime="2019-07-21T07:15:06.000Z" class="entry-date">
        2019-07-21
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
</article>






  
    <article id="post-linux" class="post-linux post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/07/13/linux/">linux之scp</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2019/07/13/linux/" data-id="ck00i1mz6000klcdaelrbu2aj" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp local_file remote_username@remote_ip:remote_folder</span><br></pre></td></tr></table></figure>
<p>或者 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp local_file remote_username@remote_ip:remote_file</span><br></pre></td></tr></table></figure>
<p>或者 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp local_file remote_ip:remote_folder</span><br></pre></td></tr></table></figure>
<p>或者 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp local_file remote_ip:remote_file</span><br></pre></td></tr></table></figure>
<p>若需要传文件夹，则加 -r</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/07/13/linux/">
    <time datetime="2019-07-13T06:57:46.000Z" class="entry-date">
        2019-07-13
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
</article>






  
    <article id="post-hive笔记" class="post-hive笔记 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/07/11/hive笔记/">hive笔记1</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2019/07/11/hive笔记/" data-id="ck00i1myj0004lcdab471wpy1" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>#hive笔记1</p>
<hr>
<p>##select<br>语法结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT [ALL | DISTINCT] select_expr, select_expr, ... </span><br><span class="line">FROM table_reference</span><br><span class="line">[WHERE where_condition] </span><br><span class="line">[GROUP BY col_list [HAVING condition]] </span><br><span class="line">[CLUSTER BY col_list </span><br><span class="line">  | [DISTRIBUTE BY col_list] [SORT BY| ORDER BY col_list] </span><br><span class="line">] </span><br><span class="line">[LIMIT number]</span><br></pre></td></tr></table></figure></p>
<p>其中，<code>CLUSTER BY col_list</code>就等同于<code>DISTRIBUTE BY col_list</code>+<code>SORT BY</code><br>若使用distribute by,分发数量由reduce的数量决定。<br>外部表和内部表的区别：<br>外部表在drop时，只删表结构和表，不删原数据，即集群数据还在。</p>
<p><code>sort by</code> 和 <code>order by</code>的区别：<br>    <code>sort by</code> 组内有序<br>    <code>order by</code> 全局排序，只有一个reduce</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/07/11/hive笔记/">
    <time datetime="2019-07-11T14:04:23.000Z" class="entry-date">
        2019-07-11
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/深度学习/">深度学习</a></li></ul>

    </footer>
</article>






  
    <article id="post-interview-3" class="post-interview-3 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/09/11/interview-3/">1042. 托普利兹矩阵 python</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/09/11/interview-3/" data-id="ck00i1myr0008lcda62ot5lqy" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">描述</span><br><span class="line">“托普利兹矩阵”是指如果从左上角到右下角的同一条主斜线上每个元素都相等的矩阵.</span><br><span class="line"></span><br><span class="line">给定一个M x N矩阵，判断是否为“托普利兹矩阵”.</span><br><span class="line">matrix 是一个二维整数数组.</span><br><span class="line">matrix 的行列范围都为 [1, 20].</span><br><span class="line">matrix[i][j] 的整数取值范围为[0, 99].</span><br><span class="line">您在真实的面试中是否遇到过这个题？  是</span><br><span class="line">题目纠错</span><br><span class="line">样例</span><br><span class="line">样例 1:</span><br><span class="line"></span><br><span class="line">输入: matrix = [[1,2,3,4],[5,1,2,3],[9,5,1,2]]</span><br><span class="line">输出: True</span><br><span class="line">解释:</span><br><span class="line">1234</span><br><span class="line">5123</span><br><span class="line">9512</span><br><span class="line"></span><br><span class="line">在上述矩阵中，主斜线上元素分别为 &quot;[9]&quot;, &quot;[5, 5]&quot;, &quot;[1, 1, 1]&quot;, &quot;[2, 2, 2]&quot;, &quot;[3, 3]&quot;, &quot;[4]&quot;, 每一条主斜线上元素都相等，所以返回`True`.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">样例 2:</span><br><span class="line"></span><br><span class="line">输入: matrix = [[1,2],[2,2]]</span><br><span class="line">输出: False</span><br><span class="line">解释:</span><br><span class="line">主斜线 &quot;[1, 2]&quot; 有不同的元素.</span><br></pre></td></tr></table></figure>
<p>简单题，直接代码：<br>python<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Solution:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    @param matrix: the given matrix</span><br><span class="line">    @return: True if and only if the matrix is Toeplitz</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def isToeplitzMatrix(self, matrix):</span><br><span class="line">        # Write your code here</span><br><span class="line">        for i in range(1,len(matrix)):</span><br><span class="line">            for j in range(1,len(matrix[0])):</span><br><span class="line">                if matrix[i][j]!=matrix[i-1][j-1]:</span><br><span class="line">                    return False</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure></p>
<p>java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> matrix: the given matrix</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: True if and only if the matrix is Toeplitz</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isToeplitzMatrix</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Write your code here</span></span><br><span class="line">        <span class="keyword">int</span> m = matrix.length;</span><br><span class="line">        <span class="keyword">int</span> n = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(matrix[i][j]!=matrix[i-<span class="number">1</span>][j-<span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/09/11/interview-3/">
    <time datetime="2018-09-11T12:30:02.000Z" class="entry-date">
        2018-09-11
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>
</article>






  
    <article id="post-interview-2" class="post-interview-2 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/09/11/interview-2/">lintcode 814. Shortest Path in Undirected Graph 之python 和 java 实现</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/09/11/interview-2/" data-id="ck00i1myo0006lcda4t4tkquo" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>最近没有动力学习，今天看到小宝贝那么努力学注会，顿感羞愧。</p>
<p>虽然收到了offercall，但还没有确定之前，还是好好刷刷题。既然有自己的目标，就应该给出自己的态度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">814. 无向图中的最短路径</span><br><span class="line"></span><br><span class="line">给出一个undirected graph，其中每条边的长度为1，并从图中给出两个节点。我们需要找到给定两个节点之间最短路径的长度。</span><br><span class="line"></span><br><span class="line">样例</span><br><span class="line"></span><br><span class="line">给定图= &#123;1,2,4#2,1,4#3,5#4,1,2#5,3&#125;，nodeA = 3, nodeB = 5。</span><br></pre></td></tr></table></figure></p>
<p>首先想到的是深度优先搜索。写了好久，关于如何确定遍历完一层，res++的地方没理清楚。于是在网上搜了下资料，有c和java版的，就看了下别人的代码，再用python给实现一下。<br>AC了 哈哈。其实我也不知道刷题用什么好，Python简洁好写，在写代码时候比Java省不少事，之前有个快排的题，同样思路，我用Java和Python分别实现，发现Python比Java短了不只一倍，看着很舒服，有点像伪代码。但是Java代码AC了，用了60ms多，但是Python 超时，6000多ms..</p>
<p>很尴尬。</p>
<p>个人还是喜欢Python，希望笔试不要出现这种问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">思路：广度优先搜索，用到队列</span><br><span class="line">1 取A结点入队，标记已访问，res=0，up_last = A</span><br><span class="line">2 当队列不为空时：</span><br><span class="line">	repeat:</span><br><span class="line">		取队头元素——&gt;now_node</span><br><span class="line">		如果 now_node = B</span><br><span class="line">		取now_node的邻接nodes:</span><br><span class="line">			将没有访问的node,全入队并标记访问，然后last指向最后一个</span><br><span class="line">		如果当前指针now_node等于层指针up_last，层指针指向last,并且res++</span><br><span class="line">3 return</span><br></pre></td></tr></table></figure>
<p>这里Python不叫指针，一般和Java一样，叫引用或者别的啥，我叫指针只是形象一些。</p>
<p>看代码也比较简单<br>python3.5 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class Solution:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    @param graph: a list of Undirected graph node</span><br><span class="line">    @param A: nodeA</span><br><span class="line">    @param B: nodeB</span><br><span class="line">    @return:  the length of the shortest path</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def shortestPath(self, graph, A, B):</span><br><span class="line">        import queue</span><br><span class="line">        # Write your code here</span><br><span class="line">        conti = queue.Queue()</span><br><span class="line">        visited = []</span><br><span class="line">        conti.put(A)</span><br><span class="line">        visited.append(A)</span><br><span class="line">        last = A</span><br><span class="line">        up_last = A</span><br><span class="line">        res=0</span><br><span class="line">        while not conti.empty():</span><br><span class="line">            now = conti.get()</span><br><span class="line">            if now == B:</span><br><span class="line">                return res</span><br><span class="line">            for i in now.neighbors:</span><br><span class="line">                if i not in visited:</span><br><span class="line">                    conti.put(i)</span><br><span class="line">                    visited.append(i)</span><br><span class="line">                    last = i</span><br><span class="line">            if up_last==now:</span><br><span class="line">                up_last = last</span><br><span class="line">                res +=1</span><br><span class="line">        return res</span><br></pre></td></tr></table></figure>
<p>java 参考<a href="https://blog.csdn.net/u014115273/article/details/80299072，对比看下吧" target="_blank" rel="noopener">https://blog.csdn.net/u014115273/article/details/80299072，对比看下吧</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for graph node.</span></span><br><span class="line"><span class="comment"> * class GraphNode &#123;</span></span><br><span class="line"><span class="comment"> *     int label;</span></span><br><span class="line"><span class="comment"> *     ArrayList&lt;UndirectedGraphNode&gt; neighbors;</span></span><br><span class="line"><span class="comment"> *     UndirectedGraphNode(int x) &#123; </span></span><br><span class="line"><span class="comment"> *         label = x; neighbors = new ArrayList&lt;UndirectedGraphNode&gt;(); </span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> graph: a list of Undirected graph node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> A: nodeA</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> B: nodeB</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>:  the length of the shortest path</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">shortestPath</span><span class="params">(List&lt;UndirectedGraphNode&gt; graph, UndirectedGraphNode A, UndirectedGraphNode B)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Write your code here</span></span><br><span class="line">        Queue&lt;UndirectedGraphNode&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        Set&lt;UndirectedGraphNode&gt; visited = <span class="keyword">new</span> HashSet&lt;&gt;();  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        UndirectedGraphNode last = <span class="keyword">null</span>;</span><br><span class="line">        UndirectedGraphNode upperLast = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        queue.offer(A);</span><br><span class="line">        visited.add(A);</span><br><span class="line">        upperLast = A;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            UndirectedGraphNode now = queue.poll();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(now.label == B.label)&#123;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(UndirectedGraphNode next: now.neighbors)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!visited.contains(next))&#123;</span><br><span class="line">                    queue.offer(next);</span><br><span class="line">                    visited.add(next);</span><br><span class="line">                    last = next;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(now == upperLast)&#123;</span><br><span class="line">                upperLast = last;</span><br><span class="line">                res++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;    </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;<span class="comment">//not connected</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/09/11/interview-2/">
    <time datetime="2018-09-11T11:50:07.000Z" class="entry-date">
        2018-09-11
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>
</article>






  
    <article id="post-interview-1" class="post-interview-1 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/08/21/interview-1/">44.最小子数组（python3 实现）</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/08/21/interview-1/" data-id="ck00i1myl0005lcdajh71k7s6" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>前两天在忙着搞大数据和论文，论文写差不多了，开始刷刷题，前几天笔试做的一塌糊涂，有的题明明感觉做对了，但是AC不了。趁着最近有空，赶紧找找感觉。<br>一道简单的贪心题</p>
<p><strong>44.最小子数组</strong></p>
<p>给定一个整数数组，找到一个具有最小和的子数组。返回其最小和。</p>
<p>样例</p>
<p>给出数组[1, -1, -2, 1]，返回 -3</p>
<p>注意事项</p>
<p>子数组最少包含一个数字</p>
<p><strong>解：</strong></p>
<p>从第一个数往后遍历i=1-&gt;n<br>将前k个数视为一个整体，如果这个整体&gt;0,则后面无论是什么，只要加上这个整体，肯定不会变小，所以整体直接舍弃，剩下的为新的数组nums.<br>如果，前面的数为负，如前3个数的和为-7，第4个数为8，则-7+8=1,要不要舍弃呢？后面可能没有小于-7的子数组了呀？所以 我们还要有个变量res，用来保存各阶段的最小值，如这里的-7，如果后面有比-7更小的子数组，就更新这个变量的值，如果没有，res就是一直是-7。<br>python3代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param: nums: a list of integers</span></span><br><span class="line"><span class="string">    @return: A integer indicate the sum of minimum subarray</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line"></span><br><span class="line">        sum = <span class="number">0</span></span><br><span class="line">        res = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">            sum+=i</span><br><span class="line">            <span class="keyword">if</span> sum &lt; res:</span><br><span class="line">                res = sum</span><br><span class="line">            <span class="keyword">if</span> sum &gt; <span class="number">0</span>:</span><br><span class="line">                sum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure></p>
<p>刚开始不通过,看了下数据[1,1],全是正数，而我当时设的res初值为0.本来以为至少会有1个负值。<br>所以把初值改为了第一个数。</p>
<p>每天一点 进步不难 </p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/08/21/interview-1/">
    <time datetime="2018-08-21T07:35:02.000Z" class="entry-date">
        2018-08-21
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>
</article>






  
    <article id="post-sqoop" class="post-sqoop post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/08/13/sqoop/">sqoop异常之java.lang.RuntimeException com.mysql.jdbc.exceptions.jdbc4.CommunicationsException  Communications link failure</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/08/13/sqoop/" data-id="ck00i1n110039lcdaq1r2a2zk" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>sqoop是apache旗下一款“Hadoop和关系数据库服务器之间传送数据”的工具。<br><strong>导入数据</strong>：MySQL，Oracle导入数据到Hadoop的HDFS、HIVE、HBASE等数据存储系统；<br><strong>导出数据</strong>：从Hadoop的文件系统中导出数据到关系数据库</p>
<p>将导入或导出命令翻译成mapreduce程序来实现,在翻译出的mapreduce中主要是对inputformat和outputformat进行定制.</p>
<p>1 sqoop安装<br>安装sqoop的前提是已经具备java和hadoop的环境</p>
<p>2 修改配置文件<br>$ cd $SQOOP_HOME/conf<br>$ mv sqoop-env-template.sh sqoop-env.sh<br>打开sqoop-env.sh并编辑下面几行：<br>export HADOOP_COMMON_HOME=/home/hadoop/hadoop-2.7.3/<br>export HADOOP_MAPRED_HOME=/home/hadoop/hadoop-2.7.3/<br>export HIVE_HOME=/home/work/hive/<br>这里没用HBASE，用的时候再配。</p>
<p>3 将jdbc数据包mysql-connector-java-5.1.44.jar 拷贝到 $SQOOP_HOME/lib下</p>
<p>4 检查安装时否功<br>$ cd $SQOOP_HOME/bin<br>$ sqoop-version<br>预期的输出：<br>15/12/17 14:52:32 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6<br>Sqoop 1.4.6 git commit id 5b34accaca7de251fc91161733f906af2eddbe83<br>Compiled by abe on Fri Aug 1 11:19:26 PDT 2015<br>到这里，整个Sqoop安装工作完成。</p>
<p>5 但是，有时候虽然安装成功了，但在使用中会出现各种Bug<br>比如:<br>MySQL数据库服务器中的xing/ emp表导入HDFS。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan1 bin]# ./sqoop import   \</span><br><span class="line">&gt; --connect jdbc:mysql://localhost:3306/xing   \</span><br><span class="line">&gt; --username root  \</span><br><span class="line">&gt; --password xing   \</span><br><span class="line">&gt; --table emp   \</span><br><span class="line">&gt; --m 1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Warning: /home/work/sqoop/bin/../../hbase does not exist! HBase imports will fail.</span><br><span class="line">Please set $HBASE_HOME to the root of your HBase installation.</span><br><span class="line">Warning: /home/work/sqoop/bin/../../hcatalog does not exist! HCatalog jobs will fail.</span><br><span class="line">Please set $HCAT_HOME to the root of your HCatalog installation.</span><br><span class="line">Warning: /home/work/sqoop/bin/../../accumulo does not exist! Accumulo imports will fail.</span><br><span class="line">Please set $ACCUMULO_HOME to the root of your Accumulo installation.</span><br><span class="line">18/08/13 10:42:47 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6</span><br><span class="line">18/08/13 10:42:47 WARN tool.BaseSqoopTool: Setting your password on the command-line is insecure. Consider using -P instead.</span><br><span class="line">18/08/13 10:42:48 INFO manager.MySQLManager: Preparing to use a MySQL streaming resultset.</span><br><span class="line">18/08/13 10:42:48 INFO tool.CodeGenTool: Beginning code generation</span><br><span class="line">18/08/13 10:42:48 INFO manager.SqlManager: Executing SQL statement: SELECT t.* FROM `emp` AS t LIMIT 1</span><br><span class="line">18/08/13 10:42:48 INFO manager.SqlManager: Executing SQL statement: SELECT t.* FROM `emp` AS t LIMIT 1</span><br><span class="line">18/08/13 10:42:48 INFO orm.CompilationManager: HADOOP_MAPRED_HOME is /home/hadoop/hadoop-2.7.3</span><br><span class="line">注: /tmp/sqoop-root/compile/0cbad6aa7f1605ddcd735b7cd9f9e47a/emp.java使用或覆盖了已过时的 API。</span><br><span class="line">注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。</span><br><span class="line">18/08/13 10:42:49 INFO orm.CompilationManager: Writing jar file: /tmp/sqoop-root/compile/0cbad6aa7f1605ddcd735b7cd9f9e47a/emp.jar</span><br><span class="line">18/08/13 10:42:49 WARN manager.MySQLManager: It looks like you are importing from mysql.</span><br><span class="line">18/08/13 10:42:49 WARN manager.MySQLManager: This transfer can be faster! Use the --direct</span><br><span class="line">18/08/13 10:42:49 WARN manager.MySQLManager: option to exercise a MySQL-specific fast path.</span><br><span class="line">18/08/13 10:42:49 INFO manager.MySQLManager: Setting zero DATETIME behavior to convertToNull (mysql)</span><br><span class="line">18/08/13 10:42:49 INFO mapreduce.ImportJobBase: Beginning import of emp</span><br><span class="line">18/08/13 10:42:49 INFO Configuration.deprecation: mapred.jar is deprecated. Instead, use mapreduce.job.jar</span><br><span class="line">18/08/13 10:42:50 INFO Configuration.deprecation: mapred.map.tasks is deprecated. Instead, use mapreduce.job.maps</span><br><span class="line">18/08/13 10:42:50 INFO client.RMProxy: Connecting to ResourceManager at /192.168.14.151:8032</span><br><span class="line">18/08/13 10:42:53 INFO db.DBInputFormat: Using read commited transaction isolation</span><br><span class="line">18/08/13 10:42:54 INFO mapreduce.JobSubmitter: number of splits:1</span><br><span class="line">18/08/13 10:42:54 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1532423449295_0031</span><br><span class="line">18/08/13 10:42:54 INFO impl.YarnClientImpl: Submitted application application_1532423449295_0031</span><br><span class="line">18/08/13 10:42:54 INFO mapreduce.Job: The url to track the job: http://shizhan1:8088/proxy/application_1532423449295_0031/</span><br><span class="line">18/08/13 10:42:54 INFO mapreduce.Job: Running job: job_1532423449295_0031</span><br><span class="line">18/08/13 10:43:02 INFO mapreduce.Job: Job job_1532423449295_0031 running in uber mode : false</span><br><span class="line">18/08/13 10:43:02 INFO mapreduce.Job:  map 0% reduce 0%</span><br><span class="line">18/08/13 10:43:09 INFO mapreduce.Job: Task Id : attempt_1532423449295_0031_m_000000_0, Status : FAILED</span><br><span class="line">Error: java.lang.RuntimeException: java.lang.RuntimeException: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br><span class="line"></span><br><span class="line">The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBInputFormat.setConf(DBInputFormat.java:167)</span><br><span class="line">        at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:76)</span><br><span class="line">        at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:136)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:749)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:415)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1698)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)</span><br><span class="line">Caused by: java.lang.RuntimeException: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br><span class="line"></span><br><span class="line">The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBInputFormat.getConnection(DBInputFormat.java:220)</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBInputFormat.setConf(DBInputFormat.java:165)</span><br><span class="line">        ... 9 more</span><br><span class="line">Caused by: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br><span class="line"></span><br><span class="line">The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)</span><br><span class="line">        at com.mysql.jdbc.Util.handleNewInstance(Util.java:425)</span><br><span class="line">        at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:989)</span><br><span class="line">        at com.mysql.jdbc.MysqlIO.&lt;init&gt;(MysqlIO.java:341)</span><br><span class="line">        at com.mysql.jdbc.ConnectionImpl.coreConnect(ConnectionImpl.java:2189)</span><br><span class="line">        at com.mysql.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:2222)</span><br><span class="line">        at com.mysql.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:2017)</span><br><span class="line">        at com.mysql.jdbc.ConnectionImpl.&lt;init&gt;(ConnectionImpl.java:779)</span><br><span class="line">        at com.mysql.jdbc.JDBC4Connection.&lt;init&gt;(JDBC4Connection.java:47)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)</span><br><span class="line">        at com.mysql.jdbc.Util.handleNewInstance(Util.java:425)</span><br><span class="line">        at com.mysql.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:389)</span><br><span class="line">        at com.mysql.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:330)</span><br><span class="line">        at java.sql.DriverManager.getConnection(DriverManager.java:571)</span><br><span class="line">        at java.sql.DriverManager.getConnection(DriverManager.java:215)</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBConfiguration.getConnection(DBConfiguration.java:302)</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBInputFormat.getConnection(DBInputFormat.java:213)</span><br><span class="line">        ... 10 more</span><br><span class="line">Caused by: java.net.ConnectException: 拒绝连接</span><br><span class="line">        at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)</span><br><span class="line">        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class="line">        at java.net.Socket.connect(Socket.java:579)</span><br><span class="line">        at com.mysql.jdbc.StandardSocketFactory.connect(StandardSocketFactory.java:211)</span><br><span class="line">        at com.mysql.jdbc.MysqlIO.&lt;init&gt;(MysqlIO.java:300)</span><br><span class="line">        ... 26 more</span><br></pre></td></tr></table></figure></p>
<p>可以看到，报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.RuntimeException: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br></pre></td></tr></table></figure></p>
<p>应该是主要和数据库相关，后面还有一个拒绝连接的异常。</p>
<p>在网上找了些资料，有说把<code>--connect jdbc:mysql://localhost:3306/xing</code>这里的主机名改成IP，改了无果。<br>仔细想了下，这里连不上数据库，可能是数据库配置问题，是不是Mysql不允许外部连接导致的，于是进入Mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">select host,user,password from user;</span><br></pre></td></tr></table></figure></p>
<p>看到里面乱七八糟，host为shizhan1的user是空，还有一个host为shizhan1的user是root,但是密码为空，于是把第一个记录直接delete,第二个记录的password改成root的密码。<br>GRANT ALL PRIVILEGES ON <em>.</em> TO root@”shizhan1” IDENTIFIED BY “ password “;    //为root添加远程连接的能力，（mysql安装shizhan1上）</p>
<p>最后flush一下<br>flush privileges;  </p>
<p>重新跑一下我们的sqoop，但是会报错，提示一个exist。因为虽然之前没有跑通，但是在hdfs对应目录上生成了一个文件夹，就是这个文件夹exist了。<br>删了就好，hadoop fs -rm -r /user/root/emp</p>
<p>可以重新跑sqoop了<br><img src="https://i.imgur.com/BKAWC4y.png" alt=""><br>可以看到success，搞定！</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/08/13/sqoop/">
    <time datetime="2018-08-13T03:15:50.000Z" class="entry-date">
        2018-08-13
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大数据/">大数据</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/异常解决/">异常解决</a></li></ul>

    </footer>
</article>






  
    <article id="post-echart" class="post-echart post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/08/03/echart/">echart的series中label formatter回调函数使用及样式。</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/08/03/echart/" data-id="ck00i1my90000lcdaizlp7sqr" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>今天我家宝贝儿写论文用到Echart做图，但是个性化的需要不知怎么做，找我帮忙。我很久没看前端的东西了，不过Echart那玩意好像很有意思，所以就接了下来。</p>
<p>先看需求。<img src="https://i.imgur.com/geuR6aA.png" alt=""><br>1 将紫色框部分改成自己的内容<br>2 将红色框内容去掉<br>3 将蓝色框内容改成自己定义的类别，（三种）</p>
<p>于是看了下代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">app.title = <span class="string">'嵌套环形图'</span>;</span><br><span class="line"></span><br><span class="line">option = &#123;</span><br><span class="line">    tooltip: &#123;</span><br><span class="line">        trigger: <span class="string">'item'</span>,</span><br><span class="line">        formatter: <span class="string">"&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    legend: &#123;</span><br><span class="line">        orient: <span class="string">'vertical'</span>,</span><br><span class="line">        x: <span class="string">'left'</span>,</span><br><span class="line">        data:[<span class="string">'直达'</span>,<span class="string">'营销广告'</span>,<span class="string">'搜索引擎'</span>,<span class="string">'邮件营销'</span>,<span class="string">'联盟广告'</span>,<span class="string">'视频广告'</span>,<span class="string">'百度'</span>,<span class="string">'谷歌'</span>,<span class="string">'必应'</span>,<span class="string">'其他'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    series: [</span><br><span class="line">        &#123;</span><br><span class="line">            name:<span class="string">'访问来源'</span>,</span><br><span class="line">            type:<span class="string">'pie'</span>,</span><br><span class="line">            selectedMode: <span class="string">'single'</span>,</span><br><span class="line">            radius: [<span class="number">0</span>, <span class="string">'30%'</span>],</span><br><span class="line"></span><br><span class="line">            label: &#123;</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    position: <span class="string">'inner'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            labelLine: &#123;</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    show: <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            data:[</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">335</span>, <span class="attr">name</span>:<span class="string">'直达'</span>, <span class="attr">selected</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">679</span>, <span class="attr">name</span>:<span class="string">'营销广告'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">1548</span>, <span class="attr">name</span>:<span class="string">'搜索引擎'</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            name:<span class="string">'访问来源'</span>,</span><br><span class="line">            type:<span class="string">'pie'</span>,</span><br><span class="line">            radius: [<span class="string">'40%'</span>, <span class="string">'55%'</span>],</span><br><span class="line">            label: &#123;</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    formatter: <span class="string">'&#123;a|&#123;a&#125;&#125;&#123;abg|&#125;\n&#123;hr|&#125;\n  &#123;b|&#123;b&#125;：&#125;&#123;c&#125;  &#123;per|&#123;d&#125;%&#125;  '</span>,</span><br><span class="line">                    backgroundColor: <span class="string">'#eee'</span>,</span><br><span class="line">                    borderColor: <span class="string">'#aaa'</span>,</span><br><span class="line">                    borderWidth: <span class="number">1</span>,</span><br><span class="line">                    borderRadius: <span class="number">4</span>,</span><br><span class="line">                    <span class="comment">// shadowBlur:3,</span></span><br><span class="line">                    <span class="comment">// shadowOffsetX: 2,</span></span><br><span class="line">                    <span class="comment">// shadowOffsetY: 2,</span></span><br><span class="line">                    <span class="comment">// shadowColor: '#999',</span></span><br><span class="line">                    <span class="comment">// padding: [0, 7],</span></span><br><span class="line">                    rich: &#123;</span><br><span class="line">                        a: &#123;</span><br><span class="line">                            color: <span class="string">'#999'</span>,</span><br><span class="line">                            lineHeight: <span class="number">22</span>,</span><br><span class="line">                            align: <span class="string">'center'</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// abg: &#123;</span></span><br><span class="line">                        <span class="comment">//     backgroundColor: '#333',</span></span><br><span class="line">                        <span class="comment">//     width: '100%',</span></span><br><span class="line">                        <span class="comment">//     align: 'right',</span></span><br><span class="line">                        <span class="comment">//     height: 22,</span></span><br><span class="line">                        <span class="comment">//     borderRadius: [4, 4, 0, 0]</span></span><br><span class="line">                        <span class="comment">// &#125;,</span></span><br><span class="line">                        hr: &#123;</span><br><span class="line">                            borderColor: <span class="string">'#aaa'</span>,</span><br><span class="line">                            width: <span class="string">'100%'</span>,</span><br><span class="line">                            borderWidth: <span class="number">0.5</span>,</span><br><span class="line">                            height: <span class="number">0</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        b: &#123;</span><br><span class="line">                            fontSize: <span class="number">16</span>,</span><br><span class="line">                            lineHeight: <span class="number">33</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        per: &#123;</span><br><span class="line">                            color: <span class="string">'#eee'</span>,</span><br><span class="line">                            backgroundColor: <span class="string">'#334455'</span>,</span><br><span class="line">                            padding: [<span class="number">2</span>, <span class="number">4</span>],</span><br><span class="line">                            borderRadius: <span class="number">2</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            data:[</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">335</span>, <span class="attr">name</span>:<span class="string">'直达'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">310</span>, <span class="attr">name</span>:<span class="string">'邮件营销'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">234</span>, <span class="attr">name</span>:<span class="string">'联盟广告'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">135</span>, <span class="attr">name</span>:<span class="string">'视频广告'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">1048</span>, <span class="attr">name</span>:<span class="string">'百度'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">251</span>, <span class="attr">name</span>:<span class="string">'谷歌'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">147</span>, <span class="attr">name</span>:<span class="string">'必应'</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">value</span>:<span class="number">102</span>, <span class="attr">name</span>:<span class="string">'其他'</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>经过注释调试，发现需求1只要改最后一个data集合就好，把name和value换成自己自定义的内容。<br>而需求2 3 主要在<figure class="highlight plain"><figcaption><span>'&#123;a|&#123;a&#125;&#125;&#123;abg|&#125;\n&#123;hr|&#125;\n  &#123;b|&#123;b&#125;：&#125;&#123;c&#125;  &#123;per|&#123;d&#125;%&#125;  '```这里。把、`&#123;c&#125;`去掉即可。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">最难搞的是需求3，用了2小时搞明白的。</span><br><span class="line">这里是官方文档里的介绍</span><br><span class="line">http://echarts.baidu.com/option.html#grid.tooltip.formatter</span><br><span class="line">formatter有两种写法：一种字符串模板，另一种是回调函数。</span><br><span class="line">字符串模型里写的是，我们要改的地方是该series中name的值，这里name只能有一个值，改name是不能了，所以我们可以像改需求1那样，在data中传一个变量。用回调函数，文档中对回调函数也没有写明白。这里用简单的语言再梳理一下。主要有两点：将需要的个性化信息显示出来，然后展现出好看的样式。</span><br><span class="line">第一点：</span><br><span class="line">我们的个性化需求在data里写</span><br></pre></td></tr></table></figure></p>
<p>data:[<br>    {value:335, name:’直达’,flag:’type_1’},<br>    {value:310, name:’邮件营销’,flag:’type_1’},<br>    {value:234, name:’联盟广告’,flag:’type_1’},<br>    {value:135, name:’视频广告’,flag:’type_2’},<br>    {value:1048, name:’百度’,flag:’type_2’},<br>    {value:251, name:’谷歌’,flag:’type_2’},<br>    {value:147, name:’必应’,flag:’type_3’},<br>    {value:102, name:’其他’,flag:’type_3’}<br>]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">也就是把我们需求3的内容```type_1,type_2,type_3```写在变量flag中，然后通过回调函数取出来，这里谁回调的先不管。</span><br><span class="line">回调函数的写法：</span><br><span class="line">```js</span><br><span class="line"> formatter:function(params)&#123; </span><br><span class="line">	str =  params.data.flag+ params.name+params.percent</span><br><span class="line">	return str</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>这里params就是我们的data，一条一条往里传。<br>看效果：<img src="https://i.imgur.com/RgNFyDC.png" alt=""><br>可以看到，内容改过了，就是丑了点。我们想改成原来的样子怎么办呢？这里正是官方文档中最让我头疼的，找了半天没找到，在网上也不找到解释的比较好的。<br>我们套用原有样式，只需要把我们的参数<code>params.name</code>这种替换到原来<code>{a}</code>这种的位置，我们的参数和其他内容用<code>+</code>连接。如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> formatter:<span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span>&#123; </span><br><span class="line">	str = <span class="string">'&#123;a|'</span>+ params.data.flag + <span class="string">'&#125;&#123;abg|&#125;\n&#123;hr|&#125;\n  &#123;b|'</span>+params.name+<span class="string">'：&#125; &#123;per|'</span>+params.percent + <span class="string">'%&#125;'</span></span><br><span class="line">	<span class="keyword">return</span> str</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// &#123;a| 这种表示a样式，而&#123;a&#125;这种有固定的含义，&#123;a&#125;（系列名称），&#123;b&#125;（数据项名称），&#123;c&#125;（数值）, &#123;d&#125;（百分比），样式里有条竖杠！记得区分。</span></span><br></pre></td></tr></table></figure></p>
<p>最终效果：<img src="https://i.imgur.com/eePZLaJ.png" alt=""></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/08/03/echart/">
    <time datetime="2018-08-03T07:38:46.000Z" class="entry-date">
        2018-08-03
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/echart/">echart</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可视化/">可视化</a></li></ul>

    </footer>
</article>






  
    <article id="post-zookeeper" class="post-zookeeper post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/07/12/zookeeper/">安装zookeeper时候，可以查看进程启动，但是状态显示报错 Error contacting service. It is probably not running</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://xurui.club/2018/07/12/zookeeper/" data-id="ck00i1mzm0013lcdayvphmaqp" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>最近想学一下大数据，这年头，不会大数据，都不敢说自己是21世纪新青年。</p>
<p>大数据有很多要学的框架，比如hadoop spark storm zookeeper等等，今天拿zookeeper入个门，安装过程中遇到点坑，分享一下。</p>
<p>Zookeeper是一个分布式<strong>协调</strong>服务；就是为用户的分布式应用程序提供协调服务<br>A、zookeeper是为别的分布式程序服务的<br>B、Zookeeper本身就是一个分布式程序（只要有半数以上节点存活，zk就能正常服务）<br>C、Zookeeper所提供的服务涵盖：<strong>主从协调</strong>、<strong>服务器节点动态上下线</strong>、统一配置管理、分布式共享锁、统一名称服务……<br>D、虽然说可以提供各种服务，但是zookeeper在底层其实只提供了两个功能：<br> —管理(存储，读取)用户程序提交的<strong>数据</strong>；<br> —并为用户程序提供数据节点<strong>监听</strong>服务；</p>
<p>1 部署<br>用的是三台虚拟机，centOS 7<br>jdk 8<br>zookeeper3.4.5<br>三台机器网络己配好，host配置如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan1 conf]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">127.0.0.1 shizhan1</span><br><span class="line">192.168.33.3 shizhan1</span><br><span class="line">192.168.33.4 shizhan2</span><br><span class="line">192.168.33.5 shizhan3</span><br></pre></td></tr></table></figure></p>
<p>2 安装<br><a href="https://pan.baidu.com/s/1O-E6pq3zbzoqRvxHoj66eQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1O-E6pq3zbzoqRvxHoj66eQ</a> 放我网盘了，zookeeper3.4.5</p>
<p>下载到shizhan1（第一台机子）中，我放在了<code>/root/work/</code>下<br>解压：<br><code>tar -zxvf zookeeper-3.4.5.tar.gz</code><br>重命名：<br><code>mv zookeeper-3.4.5 zookeeper</code>（重命名文件夹zookeeper-3.4.5为zookeeper,太长 写起来好麻烦）</p>
<p>3 环境变量：<br><code>vi /etc/profile</code><br>添加内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ZOOKEEPER_HOME=/root/work/zookeeper</span><br><span class="line">export PATH=$PATH:$ZOOKEEPER_HOME/bin</span><br></pre></td></tr></table></figure></p>
<p>source 一下，也就是把你写的环境变量激活一下<br><code>source /etc/profile</code></p>
<p>注意，这里三台机子都要改环境变量哟，第二部安装可以只在一个机子上装好，然后拷到其他机子上去，但是环境变量三个都要改。</p>
<p>4 配置文件<br><code>cd zookeeper/conf</code>进入conf目录<br><code>cp zoo_sample.cfg zoo.cfg</code> 把例子copy一个出来，命名为zoo.cfg,我们要改的就是这个。<br><code>vi zoo.cfg</code><br>添加内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/root/zkdata （要创建文件夹）</span><br><span class="line">dataLogDir=/root/zklogdata （要创建文件夹）</span><br><span class="line">server.1=shizhan1:2888:3888 (主机名, 心跳端口、数据端口)</span><br><span class="line">server.2=shizhan2:2888:3888</span><br><span class="line">server.3=shizhan3:2888:3888</span><br></pre></td></tr></table></figure></p>
<p>5 然后创建上面说的那俩文件夹,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/zkdata</span><br><span class="line">mkdir /root/zklogdata</span><br></pre></td></tr></table></figure></p>
<p>注意，这里三台机子都要创建。<br>6 将配好的zookeeper拷到另外两台机子上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /root/work/zookeeper hadoop@slave2:/home/hadoop/</span><br><span class="line">scp -r /root/work/zookeeper hadoop@slave3:/home/hadoop/</span><br></pre></td></tr></table></figure></p>
<p>7 在/root/zkdata/中创建myid文件，注意每台机子都要创建，但是值不一样，在步骤4中,如第一台，<code>server.1=shizhan1:2888:3888</code>，shizhan1是主机名，前面的serverl.1中的1,就是shizhan1这台机子上myid文件的值。以这台机子为例，其他两台的值分别为2 和 3。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /root/zkdata/</span><br><span class="line">echo 1 &gt; myid</span><br></pre></td></tr></table></figure></p>
<p>8 启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan1 bin]# zkServer.sh start</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /root/work/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure></p>
<p>9 查看服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan2 conf]# zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /root/work/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure></p>
<p>只有出现上面类似内容才是成功了。</p>
<p>排坑–<br>今天启动后，发现jps里有quorumpeermain<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Starting zookeeper ... already running as process 1398.</span><br><span class="line">[root@shizhan2 ~]# jps</span><br><span class="line">1398 QuorumPeerMain</span><br><span class="line">1559 Jps</span><br></pre></td></tr></table></figure></p>
<p>但是状态显示报错：Error contacting service. It is probably not running</p>
<p>1）在网上查阅资料一共有几种解决方法：<br>打开zkServer.sh 找到status)</p>
<p>STAT=<code>echo stat | nc localhost $(grep clientPort &quot;$ZOOCFG&quot; | sed -e &#39;s/.*=//&#39;) 2&gt; /dev/null| grep Mode</code><br>在nc与localhost之间加上 -q 1 （是数字1而不是字母l）<br>如果已存在则去掉<br>注:因为我用的zookeeper是3.4.5版本，所以在我的zkServer.sh脚本文件里根本没有这一行,所以没有生效</p>
<p>2）调用sh zkServer.sh status 遇到这个问题。百度，google了后发现有人是修改sh脚本里的一个nc的参数来解决，可在3.4.5的sh文件里并没有找到nc的调用。配置文档里指定的log目录没有创建导致出错，手动增加目录后重启，问题解决。<br>注:我想不是日志的问题所以这个方法根本就没有试</p>
<p>3）创建数据目录,也就是在你zoo.cfg配置文件里dataDir指定的那个目录下创建myid文件,并且指定id,改id为你zoo.cfg文件中<code>server.1=shizhan1:2888:3888</code>中的 1.只要在myid头部写入1即可.</p>
<p>4）因为防火墙没有关闭。关闭防火墙：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#查看防火墙状态</span><br><span class="line"></span><br><span class="line"> service iptables status </span><br><span class="line"></span><br><span class="line">#关闭防火墙</span><br><span class="line"> service iptables stop</span><br><span class="line">#查看防火墙开机启动状态</span><br><span class="line"> chkconfig iptables --list</span><br><span class="line">#关闭防火墙开机启动</span><br><span class="line"> chkconfig iptables off</span><br></pre></td></tr></table></figure></p>
<p> 注意：我的确在开始时候没有关闭防火墙，但是当我关闭防火墙之后也没有解决问题。</p>
<p>如果是centOS 7，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan2 conf]# systemctl stop firewalld.service</span><br><span class="line">[root@shizhan2 conf]# systemctl disable firewalld.service</span><br></pre></td></tr></table></figure></p>
<p>我就是关防火墙的时候，用了iptables 那个命令，提示中显示如下，我就大概一看，以为是说防火墙没开，其实人家早就换新命令啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@shizhan1 work]# service iptables stop</span><br><span class="line">Redirecting to /bin/systemctl stop iptables.service</span><br><span class="line">Failed to stop iptables.service: Unit iptables.service not loaded.</span><br></pre></td></tr></table></figure></p>
<p>5） 没有建立主机和ip之间的映射关系。</p>
<p>  建立主机和ip之间映射关系的命令为 vim /etc/hosts   在文件的末端加入各个主机和ip地址之间的映射关系就可以了。</p>
<p>  注意：只有在建立了映射关系之后，才可以将在同一个网段下的机器利用主机名进行文件传递。问题解决！</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/07/12/zookeeper/">
    <time datetime="2018-07-12T08:58:40.000Z" class="entry-date">
        2018-07-12
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大数据/">大数据</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/异常解决/">异常解决</a></li></ul>

    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
      </nav>
    </nav>
  


</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-content">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2019/08/31/hbase/">hbase</a>
          </li>
        
          <li>
            <a href="/2019/07/21/hive/">hive 之join的用法</a>
          </li>
        
          <li>
            <a href="/2019/07/13/linux/">linux之scp</a>
          </li>
        
          <li>
            <a href="/2019/07/11/hive笔记/">hive笔记1</a>
          </li>
        
          <li>
            <a href="/2018/09/11/interview-3/">1042. 托普利兹矩阵 python</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keras/">Keras</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLP/">NLP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echart/">echart</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lda/">lda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandas/">pandas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tensorflow/">tensorflow</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/可视化/">可视化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大数据/">大数据</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异常解决/">异常解决</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心情/">心情</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据分析/">数据分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/胶囊网络/">胶囊网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/Keras/" style="font-size: 11.67px;">Keras</a> <a href="/tags/NLP/" style="font-size: 10px;">NLP</a> <a href="/tags/echart/" style="font-size: 10px;">echart</a> <a href="/tags/hive/" style="font-size: 11.67px;">hive</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/lda/" style="font-size: 10px;">lda</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/mysql/" style="font-size: 11.67px;">mysql</a> <a href="/tags/pandas/" style="font-size: 10px;">pandas</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/sqoop/" style="font-size: 10px;">sqoop</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/可视化/" style="font-size: 10px;">可视化</a> <a href="/tags/大数据/" style="font-size: 11.67px;">大数据</a> <a href="/tags/异常解决/" style="font-size: 16.67px;">异常解决</a> <a href="/tags/心情/" style="font-size: 11.67px;">心情</a> <a href="/tags/技术/" style="font-size: 10px;">技术</a> <a href="/tags/数据分析/" style="font-size: 10px;">数据分析</a> <a href="/tags/深度学习/" style="font-size: 18.33px;">深度学习</a> <a href="/tags/胶囊网络/" style="font-size: 10px;">胶囊网络</a> <a href="/tags/面试/" style="font-size: 16.67px;">面试</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 Petrus Zhang
    All rights reserved.</p>
    <p>My Way to Better!</p>
</footer>


  <span>Hosted by <a href="https://pages.coding.me" >Coding Pages</a></span>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="/js/local_search.js"></script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>